# Atmos Configuration â€” powered by https://atmos.tools
#
# This configuration enables centralized, DRY, and consistent project scaffolding using Atmos.
#
# Included features:
# - Organizational custom commands: https://atmos.tools/core-concepts/custom-commands
# - Automated README generation: https://atmos.tools/cli/commands/docs/generate
#

# Import shared configuration used by all modules
import:
  - https://raw.githubusercontent.com/cloudposse/.github/refs/heads/main/.github/atmos/default.yaml

commands:
- name: readme
  steps:
    - "atmos docs generate readme"

- name: go
  description: Install Go
  commands:
    - name: get
      description: Get dependencies
      steps:
        - "go get"

    - name: build
      description: Build the provider
      steps:
        - "atmos go get"
        - "env GOOS=${GOOS:-linux} GOARCH=${GOARCH:-amd64} go build"

    - name: deps
      description: Get dependencies
      steps:
        - "go get github.com/gotesttools/gotestfmt/v2/cmd/gotestfmt"
        - "go mod tidy"

    - name: generate
      description: Generate code
      steps:
        - "go generate ./..."

- name: install
  description: Install the provider
  steps:
    - "go install ."

- name: testacc
  description: Run acceptance tests
  steps:
    - "TF_ACC=1 go test ./... -json -v ${TESTARGS:-} -count 1 -timeout 120m | gotestfmt"

- name: test
  description: Run tests
  steps:
    - "go test ./... -json -v ${TESTARGS:-} -timeout 5m -count 1 | gotestfmt"

- name: tfdocs
  description: Generate docs
  steps:
    - "go install github.com/hashicorp/terraform-plugin-docs/cmd/tfplugindocs"
    - "tfplugindocs generate"
